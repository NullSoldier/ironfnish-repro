"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.useAccountFixture = void 0;
/* This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/. */
const wallet_1 = require("../../wallet");
const fixture_1 = require("./fixture");
function useAccountFixture(wallet, generate = 'test', options) {
    if (typeof generate === 'string') {
        const name = generate;
        generate = async () => {
            const account = await wallet.createAccount(name, options);
            wallet_1.AssertSpending(account);
            return account;
        };
    }
    return fixture_1.useFixture(generate, {
        serialize: (account) => {
            return account.serialize();
        },
        deserialize: async (accountData) => {
            const account = await wallet.importAccount(accountData);
            if (accountData) {
                if (wallet.chainProcessor.hash && wallet.chainProcessor.sequence) {
                    await account.updateHead({
                        hash: wallet.chainProcessor.hash,
                        sequence: wallet.chainProcessor.sequence,
                    });
                }
                else {
                    await account.updateHead(null);
                }
            }
            wallet_1.AssertSpending(account);
            return account;
        },
    });
}
exports.useAccountFixture = useAccountFixture;
//# sourceMappingURL=account.js.map