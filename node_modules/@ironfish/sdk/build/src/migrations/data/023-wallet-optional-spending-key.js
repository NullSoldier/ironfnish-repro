"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Migration023 = void 0;
const migration_1 = require("../migration");
const stores_1 = require("./023-wallet-optional-spending-key/stores");
class Migration023 extends migration_1.Migration {
    constructor() {
        super(...arguments);
        this.path = __filename;
        this.database = migration_1.Database.WALLET;
    }
    prepare(node) {
        return node.wallet.walletDb.db;
    }
    async forward(_node, db, tx, logger) {
        const stores = stores_1.GetStores(db);
        for await (const account of stores.old.accounts.getAllValuesIter(tx)) {
            logger.info(`  Migrating account ${account.name}`);
            await stores.new.accounts.put(account.id, account, tx);
        }
    }
    backward(_node, _db, _tx, _logger) {
        throw new Error('Cannot reverse migration, optional spending key cannot be coerced to string');
    }
}
exports.Migration023 = Migration023;
//# sourceMappingURL=023-wallet-optional-spending-key.js.map