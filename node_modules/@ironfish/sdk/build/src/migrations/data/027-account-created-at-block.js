"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Migration027 = void 0;
const utils_1 = require("../../storage/utils");
const migration_1 = require("../migration");
const stores_1 = require("./027-account-created-at-block/stores");
class Migration027 extends migration_1.Migration {
    constructor() {
        super(...arguments);
        this.path = __filename;
        this.database = migration_1.Database.WALLET;
    }
    prepare(node) {
        return utils_1.createDB({ location: node.config.walletDatabasePath });
    }
    async forward(node, db, tx, logger) {
        const stores = stores_1.GetStores(db);
        logger.info(`Migrating account data to store block-based creation time`);
        for await (const accountValue of stores.old.accounts.getAllValuesIter(tx)) {
            logger.info(` Migrating account ${accountValue.name}`);
            await stores.new.accounts.put(accountValue.id, { ...accountValue, createdAt: null }, tx);
        }
    }
    async backward(node, db, tx, logger) {
        const stores = stores_1.GetStores(db);
        logger.info(`Reverting migration of account data to store block-based creation time`);
        for await (const accountValue of stores.new.accounts.getAllValuesIter(tx)) {
            logger.info(` Reverting migration for account ${accountValue.name}`);
            await stores.old.accounts.put(accountValue.id, { ...accountValue, createdAt: null }, tx);
        }
    }
}
exports.Migration027 = Migration027;
//# sourceMappingURL=027-account-created-at-block.js.map