"use strict";
/* This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/. */
Object.defineProperty(exports, "__esModule", { value: true });
exports.NodeUtils = void 0;
const errors_1 = require("../storage/database/errors");
const promise_1 = require("./promise");
/**
 * Try to open the node DB's and wait until they can be opened
 */
async function waitForOpen(node, abort) {
    let logged = false;
    while (!abort || !abort()) {
        try {
            await node.openDB();
            return;
        }
        catch (e) {
            if (e instanceof errors_1.DatabaseIsLockedError) {
                if (!logged) {
                    node.logger.info('Another node is using the database, waiting for that node to close.');
                    logged = true;
                }
                await promise_1.PromiseUtils.sleep(500);
                continue;
            }
            throw e;
        }
    }
}
exports.NodeUtils = { waitForOpen };
//# sourceMappingURL=node.js.map